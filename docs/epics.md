# Epic 拆分与用户故事

**项目名称:** 四川农业大学校园闲置物品交易系统  
**PRD 版本:** v1.0  
**创建日期:** 2025-10-27  
**总 Epic 数:** 7  
**总用户故事数:** 34  

---

## Epic 1: 用户认证与信用体系
**优先级:** P0  
**预估工时:** 40 小时  
**依赖:** 无  
**目标:** 建立校园专属的实名认证和信用评价机制

### 用户故事 1.1: 微信一键登录
**作为** 普通用户  
**我想要** 通过微信授权快速登录小程序  
**以便** 无需额外注册即可使用系统  

**验收标准:**
- [ ] 调用微信 `wx.login()` API 获取 code
- [ ] 后端通过 code 换取 openid 并自动创建用户账号
- [ ] 首次登录跳转至学号绑定页
- [ ] 登录状态保持 30 天（JWT Token）

**技术实现:**
- 接口: `POST /wx/auth/login`
- 参数: `{ code: string }`
- 返回: `{ token: string, userInfo: object }`

**工时:** 4 小时

---

### 用户故事 1.2: 学号实名认证
**作为** 普通用户  
**我想要** 绑定学号并提交真实姓名、学院信息  
**以便** 通过审核后发布商品和参与交易  

**验收标准:**
- [ ] 输入 12 位学号、真实姓名、学院、专业
- [ ] 上传学生证照片（≤ 5MB）
- [ ] 提交后状态显示"审核中"，3 个工作日内完成
- [ ] 审核通过后开放发布商品权限

**技术实现:**
- 新增表: `sicau_student_auth`
- 接口: `POST /wx/auth/bindStudentNo`
- 管理端审核接口: `POST /admin/user/auditAuth`

**工时:** 8 小时

---

### 用户故事 1.3: 信用积分计算
**作为** 系统  
**我想要** 根据用户行为自动计算信用积分  
**以便** 激励良好交易行为并惩罚违规操作  

**验收标准:**
- [ ] 完成交易 +10 分
- [ ] 收到好评 +5 分，差评 -5 分
- [ ] 取消订单 -5 分
- [ ] 商品被举报下架 -50 分
- [ ] 积分变动推送微信服务通知

**计分规则表:**
| 行为 | 积分变动 | 触发时机 |
|-----|---------|---------|
| 完成交易 | +10 | 买家确认收货后 |
| 好评（5 星）| +5 | 互评提交后 |
| 中评（3-4 星）| 0 | 互评提交后 |
| 差评（1-2 星）| -5 | 互评提交后 |
| 取消订单 | -5 | 付款后 5 分钟后取消 |
| 违规商品 | -50 | 管理员审核下架 |
| 完成捐赠 | +20 | 捐赠物品送达站点 |
| 准时配送（快递员）| +2 | 每单 |
| 配送超时 | -10 | 超过时效 2 小时 |

**技术实现:**
- 字段: `litemall_user.credit_score` (INT, DEFAULT 100)
- 接口: `POST /wx/user/updateCredit`
- 定时任务: 每日凌晨计算等级

**工时:** 12 小时

---

### 用户故事 1.4: 信用等级展示
**作为** 普通用户  
**我想要** 在个人主页和商品详情页看到卖家的信用等级  
**以便** 判断交易对象的可信度  

**验收标准:**
- [ ] ⭐ 新手（0-100 分）: 灰色星标
- [ ] ⭐⭐ 良好（101-300 分）: 蓝色星标
- [ ] ⭐⭐⭐ 优秀（301-500 分）: 金色星标
- [ ] ⭐⭐⭐⭐ 信誉商家（501+ 分）: 红色星标 + 认证徽章
- [ ] 点击星标显示积分详情（总分/本月获得/本月扣除）

**技术实现:**
- 接口: `GET /wx/user/creditDetail?userId=123`
- 前端组件: `<credit-badge level="3" score="350" />`

**工时:** 8 小时

---

### 用户故事 1.5: 个人主页
**作为** 普通用户  
**我想要** 查看自己的发布商品、订单记录、收藏夹  
**以便** 便捷管理我的交易活动  

**验收标准:**
- [ ] 顶部显示头像、昵称、信用等级
- [ ] Tab 切换: 我的发布（已上架/已下架）、我的订单（全部/待付款/待发货/待收货）、收藏夹
- [ ] 支持商品重新上架、编辑、删除
- [ ] 订单支持取消、申请售后

**页面布局:**
```
┌─────────────────────────────────┐
│  头像  昵称  ⭐⭐⭐（良好）       │
│  积分：350  成交：12 笔          │
├─────────────────────────────────┤
│  [我的发布] [我的订单] [收藏夹] │
├─────────────────────────────────┤
│  商品列表（瀑布流）              │
│  ┌───────┐ ┌───────┐            │
│  │商品图片│ │商品图片│            │
│  │￥50   │ │已售罄 │            │
│  └───────┘ └───────┘            │
└─────────────────────────────────┘
```

**技术实现:**
- 复用 litemall 接口: `GET /wx/user/info`
- 新增接口: `GET /wx/goods/myList`, `GET /wx/order/myList`

**工时:** 8 小时

---

## Epic 2: 商品发布与管理
**优先级:** P0  
**预估工时:** 48 小时  
**依赖:** Epic 1（需实名认证后才能发布）  
**目标:** 实现校园场景优化的商品发布和分类检索

### 用户故事 2.1: 商品发布
**作为** 已认证用户  
**我想要** 上传商品图片、填写标题/价格/描述并选择分类  
**以便** 让其他学生看到我的闲置物品  

**验收标准:**
- [ ] 必填字段: 标题（≤30 字）、价格（≥1 元）、分类、新旧程度（全新/几乎全新/轻微使用痕迹/明显使用痕迹）
- [ ] 可选字段: 原价、购买时间、详细描述（≤500 字）
- [ ] 支持上传 1-9 张图片，单张 ≤ 5MB
- [ ] 图片自动压缩至 800x800px（保持比例）
- [ ] 实时检测敏感词，包含敏感词提示并拒绝发布

**表单示例:**
```
标题: [高等数学A（第七版）上册        ]
价格: [50] 元  原价: [89] 元
分类: [教材教辅] > [通识课教材]
新旧: ○全新 ●几乎全新 ○轻微使用 ○明显使用
购买时间: [2023-09] (可选)
描述: [仅用过一学期，无笔记无划线，八五折转让]
图片: [选择图片] (最多9张)
```

**技术实现:**
- 接口: `POST /wx/goods/publish`
- 图片上传: 阿里云 OSS（回调后返回 URL）
- 敏感词检测: DFA 算法，响应时间 < 50ms

**工时:** 12 小时

---

### 用户故事 2.2: 分类标签管理
**作为** 系统管理员  
**我想要** 配置常用的商品分类标签  
**以便** 用户发布商品时快速选择，提升分类准确性  

**验收标准:**
- [ ] 一级分类（6 个）: 教材教辅、电子数码、生活用品、服饰鞋包、运动器材、其他
- [ ] 教材二级分类（4 个）: 通识课教材、专业课教材、考研资料、英语四六级
- [ ] 电子数码二级分类（4 个）: 手机、电脑、平板、配件
- [ ] 支持新增/编辑/删除分类
- [ ] 删除分类前检查是否有商品使用（有则禁止删除）

**管理后台页面:**
```
一级分类管理
├── 教材教辅 [编辑] [删除]
│   ├── 通识课教材 [编辑] [删除]
│   ├── 专业课教材 [编辑] [删除]
│   └── [+ 新增二级分类]
├── 电子数码 [编辑] [删除]
└── [+ 新增一级分类]
```

**技术实现:**
- 复用表: `litemall_category`
- 接口: `POST /admin/category/add`, `PUT /admin/category/update`, `DELETE /admin/category/delete`

**工时:** 6 小时

---

### 用户故事 2.3: 敏感词过滤
**作为** 系统  
**我想要** 自动检测商品标题/描述中的敏感词并拒绝发布  
**以便** 防止违规内容传播并保护平台声誉  

**验收标准:**
- [ ] 敏感词库包含: 代考、论文代写、刷单、黄赌毒相关词汇（初始 500+ 词）
- [ ] 用户提交时实时检测，若包含敏感词则标红提示"包含违规词汇：XXX"
- [ ] 多次尝试发布敏感内容（3 次）自动冻结账号 24 小时
- [ ] 管理后台支持新增/删除敏感词

**技术实现:**
- 新增表: `sicau_sensitive_words` (word VARCHAR(50), type TINYINT)
- 算法: DFA（Deterministic Finite Automaton）字典树
- 接口: `POST /wx/goods/checkSensitive`

**DFA 示例:**
```java
// 检测 "我要代考试" 是否包含敏感词
DFAFilter filter = new DFAFilter(敏感词库);
String text = "我要代考试";
List<String> hits = filter.getSensitiveWords(text); 
// 返回: ["代考"]
```

**工时:** 8 小时

---

### 用户故事 2.4: 教材课程名搜索
**作为** 普通用户  
**我想要** 输入课程名（如"高等数学A"）快速找到相关教材  
**以便** 无需记忆 ISBN 就能购买所需书籍  

**验收标准:**
- [ ] 搜索框支持课程名模糊匹配（如"高数" → "高等数学A/B"）
- [ ] 展示匹配课程的所有在售教材，按价格升序排列
- [ ] 教材详情页显示"适用课程：高等数学A（大一上）"
- [ ] 管理后台预置四川农业大学课程-教材映射（初始 200+ 条）

**课程-教材映射表示例:**
| 课程名 | 教材名称 | ISBN | 适用学期 |
|-------|---------|------|---------|
| 高等数学A | 高等数学（第七版）上册 | 9787040396614 | 大一上 |
| 大学英语 | 新视野大学英语读写教程1 | 9787513533898 | 大一上 |

**技术实现:**
- 新增表: `sicau_course_material` (course_name, book_name, isbn, semester)
- 接口: `GET /wx/goods/searchByCourse?keyword=高等数学`

**工时:** 10 小时

---

### 用户故事 2.5: 商品列表检索
**作为** 普通用户  
**我想要** 按分类筛选、价格排序、关键词搜索商品  
**以便** 快速找到目标物品  

**验收标准:**
- [ ] 分类筛选: 点击一级分类自动展开二级分类
- [ ] 排序方式: 默认（发布时间倒序）、价格升序、价格降序
- [ ] 价格区间: 自定义（如 50-100 元）
- [ ] 关键词搜索: 支持标题/描述模糊匹配
- [ ] 列表支持上拉加载更多（分页每页 20 条）

**筛选栏示例:**
```
分类: [全部▼] [教材教辅▼] [电子数码▼]
排序: ●默认 ○价格↑ ○价格↓
价格: [最低价] - [最高价] [确定]
搜索: [输入关键词搜索]
```

**技术实现:**
- 复用接口: `GET /wx/goods/list`
- 参数: `categoryId, minPrice, maxPrice, sortType, keyword, page, size`
- 索引优化: `category_id`, `price`, `create_time`

**工时:** 8 小时

---

### 用户故事 2.6: 商品收藏
**作为** 普通用户  
**我想要** 收藏感兴趣的商品  
**以便** 稍后快速找到并对比购买  

**验收标准:**
- [ ] 商品详情页点击"❤️ 收藏"按钮（再次点击取消收藏）
- [ ] 个人主页"收藏夹"Tab 查看所有收藏商品
- [ ] 商品被卖家下架时自动从收藏夹移除并推送通知
- [ ] 支持批量取消收藏

**技术实现:**
- 复用表: `litemall_collect`
- 接口: `POST /wx/collect/add`, `POST /wx/collect/delete`

**工时:** 4 小时

---

## Epic 3: 交易流程与支付
**优先级:** P0  
**预估工时:** 56 小时  
**依赖:** Epic 2（需有商品后才能交易）  
**目标:** 完成从下单到互评的完整交易闭环

### 用户故事 3.1: 商品详情页
**作为** 普通用户  
**我想要** 查看商品的详细信息、卖家信用、历史评价  
**以便** 做出购买决策  

**验收标准:**
- [ ] 顶部图片轮播（支持双指缩放）
- [ ] 商品信息: 标题、价格、原价、新旧程度、发布时间
- [ ] 卖家卡片: 头像、昵称、信用等级、成交笔数、[查看主页] [联系卖家]
- [ ] 商品描述: 富文本展示（支持换行）
- [ ] 底部操作栏: [收藏] [立即购买]

**技术实现:**
- 接口: `GET /wx/goods/detail?id=123`
- 卖家信用接口: `GET /wx/user/briefInfo?userId=456`

**工时:** 8 小时

---

### 用户故事 3.2: 下单与支付
**作为** 普通用户  
**我想要** 创建订单并通过微信支付完成付款  
**以便** 保障交易安全性  

**验收标准:**
- [ ] 点击"立即购买"跳转确认订单页
- [ ] 显示商品信息、总价、配送方式（自提/学生快递员配送）
- [ ] 自提时需填写联系电话，配送时需选择收货地址（宿舍楼栋-宿舍号）
- [ ] 点击"提交订单"调起微信支付
- [ ] 支付成功后订单状态变更为"待发货"，推送通知给卖家

**订单确认页示例:**
```
┌─────────────────────────────────┐
│  商品: 高等数学A（第七版）       │
│  价格: ￥50                      │
├─────────────────────────────────┤
│  配送方式:                       │
│  ○ 自提（联系电话: [填写]）     │
│  ● 学生快递员配送（+￥2）        │
│     收货地址: [7舍A栋 501]       │
├─────────────────────────────────┤
│  总计: ￥52                      │
│  [提交订单]                      │
└─────────────────────────────────┘
```

**技术实现:**
- 接口: `POST /wx/order/create`, `POST /wx/order/pay`
- 微信支付: JSAPI 调起支付，回调验证签名
- 金额校验: 订单金额二次验证防篡改

**工时:** 12 小时

---

### 用户故事 3.3: 订单状态流转
**作为** 系统  
**我想要** 自动管理订单状态并在关键节点推送提醒  
**以便** 督促买卖双方及时操作  

**验收标准:**
- [ ] 待发货（卖家 24h 内确认发货，否则推送提醒）
- [ ] 待收货（买家 7 天内确认收货，否则自动确认）
- [ ] 待评价（双方 15 天内互评，否则自动关闭）
- [ ] 已完成（资金结算给卖家）
- [ ] 已取消（买家付款后 5 分钟内可取消）

**状态机图:**
```
创建订单 ──支付成功──> 待发货 ──卖家发货──> 待收货
                          │                   │
                      24h提醒           7天自动确认
                                              │
                                         待评价
                                         15天关闭
                                              │
                                         已完成
```

**技术实现:**
- 定时任务: Spring `@Scheduled`，每小时扫描超时订单
- 接口: `POST /wx/order/ship`, `POST /wx/order/confirm`

**工时:** 10 小时

---

### 用户故事 3.4: 取消订单
**作为** 买家  
**我想要** 在付款后 5 分钟内取消订单  
**以便** 纠正误操作  

**验收标准:**
- [ ] 订单详情页显示"取消订单"按钮（付款后 5 分钟内可见）
- [ ] 点击后弹窗确认"确定取消吗？将扣除 5 积分"
- [ ] 取消成功后原路退款（1-3 个工作日到账）
- [ ] 扣除买家 5 积分，订单状态变更为"已取消"

**技术实现:**
- 接口: `POST /wx/order/cancel`
- 退款接口: 微信支付退款 API

**工时:** 6 小时

---

### 用户故事 3.5: 自提功能
**作为** 买卖双方  
**我想要** 通过小程序聊天协商自提地点和时间  
**以便** 节省配送费用  

**验收标准:**
- [ ] 商品详情页点击"联系卖家"跳转聊天页（复用微信客服消息）
- [ ] 支持发送文字、图片、位置（选择自提地点）
- [ ] 卖家可发送"预设自提地点"（如宿舍楼栋、图书馆门口）
- [ ] 自提订单无需卖家点击"发货"，买家线下拿到商品后点击"确认收货"

**技术实现:**
- 接口: `GET /wx/order/chatSession?orderId=123`
- 消息推送: 微信模板消息

**工时:** 8 小时

---

### 用户故事 3.6: 互评系统
**作为** 买卖双方  
**我想要** 在交易完成后互相评价  
**以便** 积累信用记录并帮助其他用户判断  

**验收标准:**
- [ ] 买家确认收货后进入"待评价"页面
- [ ] 评分（1-5 星）、标签（描述相符/配送及时/态度友好）、文字评价（≤200 字）
- [ ] 卖家同样评价买家（付款及时/沟通顺畅）
- [ ] 双方评价后才能查看对方评价（防止恶意差评）
- [ ] 评价后信用积分自动更新

**评价页示例:**
```
┌─────────────────────────────────┐
│  对卖家的评价                    │
│  评分: ⭐⭐⭐⭐⭐ (5星)           │
│  标签: ☑描述相符 ☑态度友好      │
│  文字: [商品很新，卖家人很好！]  │
│  [提交评价]                      │
└─────────────────────────────────┘
```

**技术实现:**
- 新增表: `sicau_comment` (order_id, from_user_id, to_user_id, rating, tags, content)
- 接口: `POST /wx/comment/add`

**工时:** 8 小时

---

### 用户故事 3.7: 举报与申诉
**作为** 买家  
**我想要** 举报描述不符的商品或申请退款  
**以便** 维护自己的权益  

**验收标准:**
- [ ] 订单详情页点击"举报商品"选择原因（描述不符/质量问题/虚假发货）
- [ ] 上传证据图片（必填，1-3 张）
- [ ] 管理员 24 小时内介入处理（联系双方核实）
- [ ] 若卖家责任，强制退款并扣除卖家 50 积分
- [ ] 若买家恶意举报，扣除买家 20 积分并记录警告

**技术实现:**
- 新增表: `sicau_report` (order_id, reporter_id, reason, images, status)
- 接口: `POST /wx/order/report`
- 管理后台: `GET /admin/report/list`, `POST /admin/report/handle`

**工时:** 4 小时

---

## Epic 4: 学生快递员配送系统
**优先级:** P1  
**预估工时:** 40 小时  
**依赖:** Epic 3（需有订单后才能配送）  
**目标:** 提供校园内兼职配送服务，提升物流时效

### 用户故事 4.1: 申请成为快递员
**作为** 信用等级 ≥ ⭐⭐ 的用户  
**我想要** 申请成为学生快递员  
**以便** 通过配送订单赚取兼职收入  

**验收标准:**
- [ ] 个人主页点击"成为快递员"入口
- [ ] 检查资格: 信用等级 ≥ ⭐⭐、无违规记录
- [ ] 填写宿舍楼栋（如"7舍A栋"）、所在校区（成都/雅安/都江堰）
- [ ] 上传学生证照片（人工审核 24 小时内完成）
- [ ] 审核通过后开通接单权限

**申请页示例:**
```
┌─────────────────────────────────┐
│  申请成为学生快递员              │
│  当前信用: ⭐⭐⭐（良好）         │
├─────────────────────────────────┤
│  宿舍楼栋: [7舍A栋]              │
│  所在校区: ●成都 ○雅安 ○都江堰  │
│  学生证照片: [上传]              │
│  [提交申请]                      │
└─────────────────────────────────┘
```

**技术实现:**
- 新增表: `sicau_courier`
- 接口: `POST /wx/courier/apply`
- 管理后台审核: `POST /admin/courier/audit`

**工时:** 8 小时

---

### 用户故事 4.2: 查看待配送订单
**作为** 学生快递员  
**我想要** 查看同校区内的待配送订单列表  
**以便** 选择合适的订单接单  

**验收标准:**
- [ ] 订单列表显示: 取件楼栋、送达楼栋、配送费、距离（步行时长）
- [ ] 仅显示同校区订单（跨校区需单独申请权限）
- [ ] 支持按距离排序（优先推荐同楼栋或相邻楼栋）
- [ ] 同一时段最多接 5 单（防止超负荷）

**订单列表示例:**
```
┌─────────────────────────────────┐
│  待配送订单（成都校区）          │
├─────────────────────────────────┤
│  7舍A栋 → 8舍C栋                 │
│  配送费: ￥2  距离: 步行5分钟    │
│  [接单]                          │
├─────────────────────────────────┤
│  图书馆 → 3舍B栋                 │
│  配送费: ￥2  距离: 步行10分钟   │
│  [接单]                          │
└─────────────────────────────────┘
```

**技术实现:**
- 接口: `GET /wx/courier/orderList?campus=成都`
- 距离计算: 预置楼栋坐标（经纬度），计算直线距离

**工时:** 10 小时

---

### 用户故事 4.3: 接单与配送
**作为** 学生快递员  
**我想要** 接单后查看取件码并按时送达  
**以便** 获得配送费并积累信用  

**验收标准:**
- [ ] 点击"接单"后订单状态变更为"配送中"
- [ ] 显示取件码（4 位数字）、卖家联系方式、买家收货地址
- [ ] 到卖家处出示取件码领取商品
- [ ] 送达后点击"完成配送"，买家确认收货后结算配送费
- [ ] 准时配送（校内 2h、跨校区 24h）+2 积分，超时 -10 积分

**配送页示例:**
```
┌─────────────────────────────────┐
│  配送中                          │
│  取件码: 1234                    │
│  取件地址: 7舍A栋 501            │
│  卖家电话: 138****5678           │
├─────────────────────────────────┤
│  送达地址: 8舍C栋 302            │
│  买家电话: 139****1234           │
│  [联系买家] [完成配送]           │
└─────────────────────────────────┘
```

**技术实现:**
- 接口: `POST /wx/courier/accept`, `POST /wx/courier/finish`
- 取件码生成: 随机 4 位数字（订单创建时生成）

**工时:** 12 小时

---

### 用户故事 4.4: 配送超时处理
**作为** 系统  
**我想要** 自动检测配送超时并扣分/禁用  
**以便** 保障配送服务质量  

**验收标准:**
- [ ] 校内订单 2 小时未完成推送提醒
- [ ] 超时 1 次警告并扣 10 积分
- [ ] 3 次超时取消快递员资格（30 天后可重新申请）
- [ ] 连续 10 单准时奖励 10 积分

**惩罚规则表:**
| 行为 | 后果 |
|-----|------|
| 接单后不配送 | 扣 20 积分 + 冻结接单 7 天 |
| 超时 1 次 | 警告 + 扣 10 积分 |
| 累计超时 3 次 | 取消资格（30 天后可重新申请）|
| 连续 10 单准时 | 奖励 10 积分 |

**技术实现:**
- 定时任务: 每 30 分钟扫描配送中订单
- 接口: `POST /admin/courier/suspend`

**工时:** 6 小时

---

### 用户故事 4.5: 收入统计
**作为** 学生快递员  
**我想要** 查看本周/本月的配送收入  
**以便** 了解兼职收益  

**验收标准:**
- [ ] 个人主页"快递员中心"显示: 累计配送单数、本周收入、本月收入
- [ ] 收入明细列表（订单号、配送费、完成时间）
- [ ] 支持提现到微信零钱（满 10 元可提现，扣除 1% 手续费）

**收入页示例:**
```
┌─────────────────────────────────┐
│  快递员中心                      │
│  累计配送: 50 单                 │
│  本周收入: ￥28                  │
│  本月收入: ￥120                 │
│  可提现余额: ￥50                │
│  [提现到微信零钱]                │
├─────────────────────────────────┤
│  收入明细                        │
│  订单 #12345  +￥2  2025-10-27  │
│  订单 #12346  +￥2  2025-10-26  │
└─────────────────────────────────┘
```

**技术实现:**
- 字段: `sicau_courier.total_income` (DECIMAL)
- 接口: `GET /wx/courier/income`, `POST /wx/courier/withdraw`

**工时:** 4 小时

---

## Epic 5: 限时拍卖模块
**优先级:** P2  
**预估工时:** 32 小时  
**依赖:** Epic 3（复用订单表）  
**目标:** 通过竞拍激发用户活跃度并提升商品成交价

### 用户故事 5.1: 发起拍卖
**作为** 信用等级 ≥ ⭐⭐ 的卖家  
**我想要** 将商品设置为限时拍卖模式  
**以便** 提升商品曝光度并获得更高收益  

**验收标准:**
- [ ] 商品发布时选择"限时拍卖"模式
- [ ] 设置起拍价（≥1 元）、加价幅度（1/5/10 元）、拍卖时长（1/3/7 天）
- [ ] 卖家缴纳保证金（起拍价 10%），拍卖结束后退回
- [ ] 拍卖商品在首页"限时拍卖"专区置顶展示

**发起拍卖页示例:**
```
┌─────────────────────────────────┐
│  限时拍卖设置                    │
│  起拍价: [100] 元                │
│  加价幅度: ○1元 ●5元 ○10元      │
│  拍卖时长: ○1天 ●3天 ○7天       │
│  保证金: ￥10（拍卖结束退回）    │
│  [发起拍卖]                      │
└─────────────────────────────────┘
```

**技术实现:**
- 新增表: `sicau_auction`
- 接口: `POST /wx/auction/create`
- 保证金: 调用微信支付 API 冻结金额

**工时:** 10 小时

---

### 用户故事 5.2: 参与竞拍
**作为** 普通用户  
**我想要** 出价竞拍感兴趣的商品  
**以便** 以更低价格拍得物品  

**验收标准:**
- [ ] 拍卖商品详情页显示: 当前价格、剩余时间（倒计时）、出价记录（前 10 条）
- [ ] 点击"出价"按钮，输入金额（≥ 当前价格 + 加价幅度）
- [ ] 出价时缴纳保证金（= 出价金额），被超越者保证金原路退回
- [ ] 出价成功后显示"您当前是最高出价者"
- [ ] 拍卖结束前 5 分钟内有新出价，自动延长 5 分钟

**竞拍页示例:**
```
┌─────────────────────────────────┐
│  限时拍卖                        │
│  当前价格: ￥150                 │
│  剩余时间: 02:35:12              │
│  出价记录:                       │
│  用户A  ￥150  2025-10-27 10:30 │
│  用户B  ￥145  2025-10-27 10:25 │
│  [我要出价]                      │
└─────────────────────────────────┘
```

**技术实现:**
- 新增表: `sicau_auction_bid`
- 接口: `POST /wx/auction/bid`
- 延时规则: 检测 `end_time - now() < 5min` 时更新结束时间

**工时:** 10 小时

---

### 用户故事 5.3: 拍卖结算
**作为** 系统  
**我想要** 拍卖结束后自动生成订单并通知中标者  
**以便** 完成交易流程  

**验收标准:**
- [ ] 拍卖结束时自动生成订单（最高出价者为买家）
- [ ] 推送通知给中标者"恭喜您拍得 XXX，请 24 小时内付款"
- [ ] 中标者未付款则扣除保证金并取消资格，第二高出价者递补
- [ ] 卖家保证金原路退回

**技术实现:**
- 定时任务: 每分钟扫描 `end_time < now()` 的拍卖
- 接口: `POST /admin/auction/settle`

**工时:** 8 小时

---

### 用户故事 5.4: 拍卖数据统计
**作为** 系统管理员  
**我想要** 查看拍卖成交率、平均溢价率  
**以便** 评估拍卖功能的效果  

**验收标准:**
- [ ] 管理后台显示: 本周拍卖数、成交率（成交数/发起数）、平均溢价率（成交价/起拍价）
- [ ] 热门拍卖商品 TOP 10（按出价次数排序）
- [ ] 支持导出 Excel 报表

**技术实现:**
- 接口: `GET /admin/auction/statistics`

**工时:** 4 小时

---

## Epic 6: 公益捐赠通道
**优先级:** P2  
**预估工时:** 24 小时  
**依赖:** 无  
**目标:** 建立校园公益通道，促进闲置资源再分配

### 用户故事 6.1: 提交捐赠申请
**作为** 普通用户  
**我想要** 将闲置物品捐赠给需要的同学  
**以便** 践行公益并获得信用积分  

**验收标准:**
- [ ] 个人主页点击"公益捐赠"入口
- [ ] 上传物品照片（1-3 张）、选择分类（衣物/文具/书籍）、填写数量
- [ ] 选择取件方式: 自送至捐赠站点 / 预约志愿者上门
- [ ] 提交后等待管理员审核（24 小时内）

**捐赠申请页示例:**
```
┌─────────────────────────────────┐
│  公益捐赠                        │
│  物品照片: [上传照片]            │
│  分类: ●衣物 ○文具 ○书籍        │
│  数量: [5] 件                    │
│  取件方式:                       │
│  ○ 自送至捐赠站点（图书馆一楼）  │
│  ● 预约志愿者上门                │
│  [提交申请]                      │
└─────────────────────────────────┘
```

**技术实现:**
- 新增表: `sicau_donation`
- 接口: `POST /wx/donation/submit`

**工时:** 8 小时

---

### 用户故事 6.2: 管理员审核捐赠
**作为** 系统管理员  
**我想要** 审核捐赠物品的完好度和公益适配性  
**以便** 保障受捐者权益  

**验收标准:**
- [ ] 管理后台"捐赠审核"列表显示待审核申请
- [ ] 查看物品照片、分类、数量
- [ ] 选择"通过"或"拒绝"（拒绝需填写原因）
- [ ] 通过后分配志愿者（若选择上门取件）

**审核页示例:**
```
申请 #123
用户: 张三  信用: ⭐⭐⭐
物品: 5 件衣物（照片 3 张）
取件方式: 预约志愿者上门
地址: 7舍A栋 501
[通过] [拒绝]
```

**技术实现:**
- 接口: `POST /admin/donation/audit`

**工时:** 6 小时

---

### 用户故事 6.3: 捐赠完成奖励
**作为** 系统  
**我想要** 在捐赠完成后给用户奖励积分  
**以便** 激励更多人参与公益  

**验收标准:**
- [ ] 志愿者确认收货后捐赠状态变更为"已完成"
- [ ] 用户获得 +20 积分
- [ ] 累计捐赠 5 次获得"爱心大使"徽章（个人主页展示）
- [ ] 推送感谢通知

**技术实现:**
- 接口: `POST /wx/donation/finish`
- 徽章系统: 新增字段 `litemall_user.badges` (JSON)

**工时:** 10 小时

---

## Epic 7: 管理后台增强
**优先级:** P1  
**预估工时:** 32 小时  
**依赖:** 所有 Epic（需有业务数据后才能管理）  
**目标:** 提供高效的内容审核和数据监控能力

### 用户故事 7.1: 学号认证审核
**作为** 高级管理员  
**我想要** 批量审核学号认证申请  
**以便** 保障平台用户身份真实性  

**验收标准:**
- [ ] 待审核列表显示: 用户昵称、学号、学院、学生证照片
- [ ] 点击照片查看大图（放大缩小）
- [ ] 支持批量通过/拒绝（拒绝需填写原因）
- [ ] 通过后用户获得发布商品权限

**技术实现:**
- 接口: `GET /admin/user/authList`, `POST /admin/user/auditAuth`

**工时:** 6 小时

---

### 用户故事 7.2: 违规账号封禁
**作为** 管理员  
**我想要** 对违规账号进行冻结或封禁  
**以便** 维护平台秩序  

**验收标准:**
- [ ] 用户管理列表支持搜索（学号/昵称）
- [ ] 违规账号标记（红色显示）
- [ ] 封禁操作: 24h 冻结 / 永久封禁（高级管理员专属）
- [ ] 封禁后记录操作日志（管理员 ID、时间、原因）

**权限分级:**
| 操作 | 一般管理员 | 高级管理员 |
|-----|-----------|-----------|
| 24h 冻结 | ✅ | ✅ |
| 永久封禁 | ❌ | ✅ |

**技术实现:**
- 接口: `POST /admin/user/ban`
- 日志表: `sicau_admin_log`

**工时:** 8 小时

---

### 用户故事 7.3: 交易纠纷处理
**作为** 管理员  
**我想要** 快速处理用户举报和纠纷  
**以便** 降低用户投诉率  

**验收标准:**
- [ ] 举报列表显示: 订单号、举报原因、证据图片、举报时间
- [ ] 点击查看订单详情和聊天记录
- [ ] 处理方式: 强制退款 / 驳回举报 / 联系双方协商
- [ ] 处理后更新状态并推送结果通知

**技术实现:**
- 接口: `GET /admin/report/list`, `POST /admin/report/handle`

**工时:** 10 小时

---

### 用户故事 7.4: 数据统计大屏
**作为** 系统管理员  
**我想要** 查看平台运营数据  
**以便** 评估业务健康度并优化策略  

**验收标准:**
- [ ] 核心指标: 日活用户（DAU）、周活用户（WAU）、月活用户（MAU）
- [ ] 交易数据: 日/周/月订单数、GMV、客单价
- [ ] 用户数据: 注册增长曲线、信用等级分布
- [ ] 商品数据: 热门分类 TOP 5、成交周期中位数
- [ ] 支持导出 Excel 报表

**数据大屏示例:**
```
┌─────────────────────────────────┐
│  今日数据（2025-10-27）          │
│  DAU: 2,350  订单: 128  GMV: ¥15,320 │
├─────────────────────────────────┤
│  本周订单趋势（折线图）          │
│  周一 95  周二 110  周三 128...  │
├─────────────────────────────────┤
│  热门分类（饼图）                │
│  教材 40%  数码 30%  生活 20%... │
└─────────────────────────────────┘
```

**技术实现:**
- 接口: `GET /admin/statistics/dashboard`
- 图表库: ECharts

**工时:** 8 小时

---

## 附录

### A. 优先级说明
- **P0 (高优先级)**: MVP 核心功能，必须在第一版实现
- **P1 (中优先级)**: 重要功能，可在第二版迭代
- **P2 (低优先级)**: 增值功能，可在第三版优化

### B. 预估工时分布
| Epic | P0 工时 | P1 工时 | P2 工时 | 总计 |
|-----|--------|--------|--------|------|
| Epic 1 | 40h | - | - | 40h |
| Epic 2 | 48h | - | - | 48h |
| Epic 3 | 56h | - | - | 56h |
| Epic 4 | - | 40h | - | 40h |
| Epic 5 | - | - | 32h | 32h |
| Epic 6 | - | - | 24h | 24h |
| Epic 7 | - | 32h | - | 32h |
| **合计** | **144h** | **72h** | **56h** | **272h** |

**开发周期估算:**
- **Phase 1 (MVP - P0)**: 144h ÷ 40h/周 = 约 4 周
- **Phase 2 (增强 - P1)**: 72h ÷ 40h/周 = 约 2 周
- **Phase 3 (优化 - P2)**: 56h ÷ 40h/周 = 约 1.5 周
- **总计**: 7.5 周（约 2 个月）

### C. 风险与依赖
| Epic | 外部依赖 | 风险 |
|-----|---------|------|
| Epic 1 | 微信开放平台 API | 学号审核成本较高 |
| Epic 3 | 微信支付 API | 支付手续费 0.6% |
| Epic 4 | 四川农业大学楼栋坐标 | 快递员招募难度 |
| Epic 5 | 无 | 拍卖流拍率可能较高 |
| Epic 6 | 校学生会合作 | 志愿者资源有限 |

---

**文档状态**: ✅ 已完成  
**下一步**: 基于 Epic 拆分创建用户故事卡片（使用 GitHub Issues 或 Jira）  
**预计开始时间**: 2025 年 4 月（按开题报告时间安排）
